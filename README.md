EFAutomation
============

EFAutomation is a convention based extension library for Entity Framework to automate several tasks currently cumbersome to do. It allows developers to create an Entity Framework based Context without having to specify each entity by putting it as DbSet<> as property. 

Basic usage
============

1) Create the context factory
```c#
private IAutoContextFactory _autoContextFactory;
_autoContextFactory = new AutoContextFactory();
```

2) Configure the factory
```c#
_autoContextFactory.Configuration.AutoGeneratedMigrationsEnabled = true; 
_autoContextFactory.Configuration.AutoMigrateGeneratedMigrationsEnabled = true;
_autoContextFactory.Configuration.MigrationsDirectory = @"ProjectDir\Migrations";
_autoContextFactory.AddEntitiesBasedOn<BaseEntity>().AddAssemblyContaining<BaseEntity>();
```
3) Create the context and use it
```c#
var context = _autoContextFactory.Context();
context.Set<Item>().Add(new Item());
context.SaveChanges();
```

Detailed info
=============

### Context
EFAutomation declares an IContext interface which declares effectively same functions as original DbContext and adds some of its own, such as events. You are free to cast it to standard DbContext if you wish.

Context is **factory persistent**. Once created, it stays the way it is for the entire lifecycle of the factory. Any events added to the context are also present in every other Context() call. This is due a few sacrifices needed to make in order to give the factory a little bit of modularity.

### Configuration
**IAutoContextFactory** provides several configuration options. 
* MigrationsDirectory - where you want the program to store its migration files. The files are standard Code First Migration files. This directory should be included in your source control to allow synchronized migrations between developers.

* AutoMigrateToLatestVersionEnabled - this is an option normally used in standard Code First Migration Configuration as **AutomaticMigrationsEnabled**, having this option on disables the Code Based migration generation.

* AutomaticMigrationDataLossAllowed - goes together with AutoMigrateToLatestVersionEnabled, allows data loss on automatic migrations.

* AutoGeneratedMigrationsEnabled - option used to specify that, if model has changed, a new migration should be generated. This option exists so programmatic migration generation through Factory could be used.

* AutoMigrateGeneratedMigrationsEnabled - option used to specify whether, if model has changed, newly generated migrations should be migrated to database. If this feature is disabled, migrations need to be done programmatically through Factory. If AutoGeneratedMigrationsEnabled is set to false, migrations need to be generated programmatically or migrations will fail.

* Connection - your standard connectionstring or connectionstring name


#### Migrations
EFAutomation supports Code First Migrations - both automatic and, as a new feature - code based automatic. This means that the library generates the Code First files on its own, migrating them as needed, with possibility to choose when and how to migrate.




```c#
var contextFactory = new AutoContextFactory();
IContext context = contextFactory.CreateContext();
// Use context as you would normal context
```

#### Events
**All events fire before their base events**

IContext declares several events.

* SavingChanges
```c#
context.SavingChanges += (sender, args) => { args.Context.(...);/* args.Context is IContext */ };
```

* ModelCreating
```c#
context.ModelCreating += (sender, args) => { args.ModelBuilder.(...);/* args.ModelBuilder is standard DbModelBuilder */};
```

