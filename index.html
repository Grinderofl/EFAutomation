<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Entity Framework Automation : " />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Entity Framework Automation</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/Grinderofl/EFAutomation">View on GitHub</a>

          <h1 id="project_title">Entity Framework Automation</h1>
          <h2 id="project_tagline"></h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/Grinderofl/EFAutomation/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/Grinderofl/EFAutomation/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="efautomation" class="anchor" href="#efautomation"><span class="octicon octicon-link"></span></a>EFAutomation</h1>

<p>EFAutomation is a convention based extension library for Entity Framework to automate several tasks currently cumbersome to do. It allows developers to create an Entity Framework based Context without having to specify each entity by putting it as DbSet&lt;&gt; as property. </p>

<p>NuGet: <a href="http://www.nuget.org/packages/EFAutomation/">http://www.nuget.org/packages/EFAutomation/</a></p>

<h1>
<a name="basic-usage" class="anchor" href="#basic-usage"><span class="octicon octicon-link"></span></a>Basic usage</h1>

<p>1) Create the context factory</p>

<div class="highlight highlight-c#"><pre><span class="k">private</span> <span class="n">IAutoContextFactory</span> <span class="n">_autoContextFactory</span><span class="p">;</span>
<span class="n">_autoContextFactory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">AutoContextFactory</span><span class="p">();</span>
</pre></div>

<p>2) Configure the factory</p>

<div class="highlight highlight-c#"><pre><span class="n">_autoContextFactory</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="n">AutoGeneratedMigrationsEnabled</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span> 
<span class="n">_autoContextFactory</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="n">AutoMigrateGeneratedMigrationsEnabled</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
<span class="n">_autoContextFactory</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="n">MigrationsDirectory</span> <span class="p">=</span> <span class="s">@"ProjectDir\Migrations"</span><span class="p">;</span>
<span class="n">_autoContextFactory</span><span class="p">.</span><span class="n">AddEntitiesBasedOn</span><span class="p">&lt;</span><span class="n">BaseEntity</span><span class="p">&gt;().</span><span class="n">AddAssemblyContaining</span><span class="p">&lt;</span><span class="n">BaseEntity</span><span class="p">&gt;();</span>
</pre></div>

<p>3) Create the context and use it</p>

<div class="highlight highlight-c#"><pre><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="n">_autoContextFactory</span><span class="p">.</span><span class="n">Context</span><span class="p">();</span>
<span class="n">context</span><span class="p">.</span><span class="n">Set</span><span class="p">&lt;</span><span class="n">Item</span><span class="p">&gt;().</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Item</span><span class="p">());</span>
<span class="n">context</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>
</pre></div>

<h1>
<a name="detailed-info" class="anchor" href="#detailed-info"><span class="octicon octicon-link"></span></a>Detailed info</h1>

<h3>
<a name="lifecycle" class="anchor" href="#lifecycle"><span class="octicon octicon-link"></span></a>Lifecycle</h3>

<p>Factory lifecyle should be same as your applicatin lifecycle. Every Context() call checks if database has already been migrated, provided AutoMigrateGeneratedMigrationsEnabled is set to true. If you manage migrations manually, lifecycle can be anything and you will be responsible for performance and errors. IContext lifecycle can be anything you would normally set a standard DbContext to.</p>

<h3>
<a name="context" class="anchor" href="#context"><span class="octicon octicon-link"></span></a>Context</h3>

<p>EFAutomation declares an IContext interface which declares effectively same functions as original DbContext and adds some of its own, such as events. You are free to cast it to standard DbContext if you wish.</p>

<p>Context() call from Factory also accepts a string parameter for connection string, either full connectionstring or the name of it, just like standard DbContext. It's suggested to just set the Connection option under Configuration property, though.</p>

<h3>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h3>

<p><strong>IAutoContextFactoryConfiguration</strong> provides several configuration options. </p>

<ul>
<li><p><strong>MigrationsDirectory</strong> - where you want the program to store its migration files. The files are standard Code First Migration files. This directory should be included in your source control to allow synchronized migrations between developers.</p></li>
<li><p><strong>AutoMigrateToLatestVersionEnabled</strong> - this is an option normally used in standard Code First Migration Configuration as <em>AutomaticMigrationsEnabled</em>, having this option on disables the Code Based migration generation.</p></li>
<li><p><strong>AutomaticMigrationDataLossAllowed</strong> - goes together with AutoMigrateToLatestVersionEnabled, allows data loss on automatic migrations.</p></li>
<li><p><strong>AutoGeneratedMigrationsEnabled</strong> - option used to specify that, if model has changed, a new migration should be generated. This option exists so programmatic migration generation through Factory could be used.</p></li>
<li><p><strong>AutoMigrateGeneratedMigrationsEnabled</strong> - option used to specify whether, if model has changed, newly generated migrations should be migrated to database. If this feature is disabled, migrations need to be done programmatically through Factory. If AutoGeneratedMigrationsEnabled is set to false, migrations need to be generated programmatically or migrations will fail.</p></li>
<li><p><strong>Connection</strong> - your standard connectionstring or connectionstring name</p></li>
<li><p><strong>MigrationsAssemblyAsFile</strong> - option used if you want migrations to be compiled into a file or loaded from an existing file. Useful if you want to deploy your application but not distribute the .cs  files. Make sure to set the file name.</p></li>
<li><p><strong>MigrationsAssemblyFileLocation</strong> - name of the file the compiled migration assembly should be saved to. Only functions when MigrationsAssemblyAsFile is true.</p></li>
</ul><p><strong>NB! Order of operations is important. Any configuration should be done before Context(), MigratToLatest() or GenerateMigrations() are called for the first time on Factory</strong></p>

<h3>
<a name="factory" class="anchor" href="#factory"><span class="octicon octicon-link"></span></a>Factory</h3>

<ul>
<li><p><strong>Configuration</strong> - IAutoContextFactoryConfiguration for configuring the factory</p></li>
<li><p><strong>AddEntitiesBasedOn&lt;T&gt;()</strong> - This method allows convention based adding of entities to the context. All entities that are not abstract and are based on this class (or these classes, if you add more than one) are automatically added. Assemblies to be searched from also needs to be added.</p></li>
<li><p><strong>AddEntity&lt;T&gt;()</strong> - Adds a single entity to context.</p></li>
<li><p><strong>AddAssemblyContaining&lt;T&gt;()</strong> - Adds an assembly which should be searched for convention-added classes, which contains specified class.</p></li>
</ul><div class="highlight highlight-c#"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">EntityBase</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">EntityOne</span> <span class="p">:</span> <span class="n">EntityBase</span> <span class="p">{}</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">EntityTwo</span> <span class="p">:</span> <span class="n">EntityBase</span> <span class="p">{}</span>

<span class="n">factory</span><span class="p">.</span><span class="n">AddEntitiesBasedOn</span><span class="p">&lt;</span><span class="n">EntityBase</span><span class="p">&gt;().</span><span class="n">AddAssemblyContaining</span><span class="p">&lt;</span><span class="n">EntityOne</span><span class="p">&gt;();</span> 
<span class="c1">// Adds EntityOne and EntityTwo to context</span>
</pre></div>

<ul>
<li><p><strong>AddAssembly(Assembly assembly)</strong> - Adds a single assembly that should be searched for convention-added classes.</p></li>
<li><p><strong>Context()</strong> - Retrieves the context (and also causes it to be generated if it hasn't yet). If AutoMigrateGeneratedMigrationsEnabled is true, migrations are also run.</p></li>
<li><p><strong>MigrateToLatest()</strong> - Migrates the database to latest version (and also causes context to be generated if it hasn't yet). If AutoGeneratedMigrationsEnabled is true, missing migrations are automatically generated.</p></li>
<li><p><strong>GenerateMigrations()</strong> - Generates migrations and saves them under specified migrations directory (and also causes context to be generated if it hasn't yet). <em>Does not automatically migrate</em>.</p></li>
<li><p><strong>IncludedTypes()</strong> - Returns a list of types currently included in the context.</p></li>
</ul><p><strong>NB! Order of operations is important. Any other method should be called before Context(), MigratToLatest() or GenerateMigrations() are called for the first time on Factory</strong> </p>

<h1>
<a name="events" class="anchor" href="#events"><span class="octicon octicon-link"></span></a>Events</h1>

<p><strong>All events fire before their original base events</strong></p>

<h3>
<a name="icontext-events" class="anchor" href="#icontext-events"><span class="octicon octicon-link"></span></a>IContext Events</h3>

<ul>
<li>SavingChanges - executed when changes are being saved. Gets executed in both Async and normal saving.</li>
</ul><div class="highlight highlight-c#"><pre><span class="n">context</span><span class="p">.</span><span class="n">SavingChanges</span> <span class="p">+=</span> <span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="n">args</span><span class="p">.</span><span class="n">Context</span><span class="p">.(...);</span><span class="cm">/* args.Context is IContext */</span> <span class="p">};</span>
</pre></div>

<ul>
<li>ModelCreating - executed when model is being created. Conventions should be set up here.</li>
</ul><div class="highlight highlight-c#"><pre><span class="n">context</span><span class="p">.</span><span class="n">ModelCreating</span> <span class="p">+=</span> <span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="n">args</span><span class="p">.</span><span class="n">ModelBuilder</span><span class="p">.(...);</span><span class="cm">/* args.ModelBuilder is standard DbModelBuilder */</span><span class="p">};</span>
</pre></div>

<h3>
<a name="iautocontextfactory-events" class="anchor" href="#iautocontextfactory-events"><span class="octicon octicon-link"></span></a>IAutoContextFactory Events</h3>

<ul>
<li>Seeding - executed when database is seeded. Put your AddOrUpdate events here.</li>
</ul><div class="highlight highlight-c#"><pre><span class="n">factory</span><span class="p">.</span><span class="n">Seeding</span> <span class="p">+=</span> <span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="n">args</span><span class="p">.</span><span class="n">Context</span><span class="p">.(...);</span> <span class="cm">/* args.Context is IContext */</span> <span class="p">};</span>
</pre></div>

<h1>
<a name="todo" class="anchor" href="#todo"><span class="octicon octicon-link"></span></a>TODO</h1>

<ul>
<li>Perhaps give separate events for async savechanges?</li>
<li>Add methods to retrieve currently added assemblies or base entities.</li>
<li>Add Identity support.</li>
</ul><h1>
<a name="known-bugs" class="anchor" href="#known-bugs"><span class="octicon octicon-link"></span></a>Known bugs</h1>

<ul>
<li>Might have random file access errors.</li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Entity Framework Automation maintained by <a href="https://github.com/Grinderofl">Grinderofl</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
